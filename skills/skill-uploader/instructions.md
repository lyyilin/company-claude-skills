# Skill Uploader 指令

## 目标

当用户说"打包 [路径] 上传到 GitHub 仓库"时，自动完成以下操作：
1. 检测或配置仓库位置
2. 复制 Skill 文件到仓库
3. 执行 Git 提交和推送
4. 返回操作结果

## 触发条件

当用户的输入包含以下关键词时触发：
- "打包" + "上传" + "GitHub"
- "上传" + "skill" + "仓库"
- "提交" + "skill" + "GitHub"

## 工作流程

### 步骤 1：检测配置

1. 检查项目的 `.claude/skill-uploader-config.json` 是否存在
2. 如果存在，读取 `repository_path` 配置
3. 如果不存在，进入配置流程

**配置流程：**
```
询问用户：
"检测到这是首次使用 skill-uploader。

请问你的 company-claude-skills 仓库克隆在哪里？
例如：F:\company_GitHub\company-claude-skills"

等待用户回答仓库路径
验证路径是否存在
创建配置文件并保存路径
```

### 步骤 2：解析用户输入

从用户输入中提取 Skill 源路径：
- 识别路径格式（如 `F:\Desktop\my-skill`）
- 验证路径是否存在
- 提取 Skill 名称（路径的最后一个文件夹名）

**如果路径无效：**
```
提示用户：
"❌ 路径不存在：[路径]

请检查路径是否正确，然后重试。"

停止执行
```

### 步骤 3：拉取最新代码

在执行上传前，先拉取最新代码避免冲突：

```bash
cd [仓库路径]
git pull origin main
```

**如果拉取失败：**
```
提示用户：
"⚠️ 拉取最新代码失败。

可能的原因：
- 网络连接问题
- 本地有未提交的更改
- 权限问题

请手动解决后重试。"

停止执行
```

### 步骤 4：复制文件

将 Skill 复制到仓库：

```
源路径：[用户提供的路径]
目标路径：[仓库路径]/skills/[skill名称]/

执行复制操作（递归复制整个文件夹）
```

**复制完成后确认：**
```
显示：
"📁 正在复制 Skill 文件..."
"✅ 文件复制完成"
```

### 步骤 5：Git 提交

执行 Git 操作：

```bash
cd [仓库路径]
git add skills/[skill名称]/
git commit -m "Add: [skill名称]"
```

**Commit 消息格式：**
- 新 Skill：`Add: [skill名称]`
- 更新 Skill：`Update: [skill名称]`

### 步骤 6：推送到 GitHub

```bash
git push origin main
```

**如果推送失败：**
```
提示用户：
"❌ 推送到 GitHub 失败。

可能的原因：
- 网络连接问题
- 没有仓库写入权限
- 需要先拉取最新代码

错误信息：[显示 Git 错误]

建议：
1. 检查网络连接
2. 确认已被添加为仓库协作者
3. 尝试手动执行：git push origin main"

停止执行
```

### 步骤 7：返回结果

成功后显示完整的操作结果：

```
✅ Skill 上传成功！

📁 Skill 名称: [skill名称]
📂 本地位置: [仓库路径]/skills/[skill名称]
🔗 GitHub: https://github.com/lyyilin/company-claude-skills/tree/main/skills/[skill名称]

已完成的操作：
1. ✅ 拉取最新代码
2. ✅ 复制文件到仓库
3. ✅ Git 提交
4. ✅ 推送到 GitHub

你的 Skill 现在可以被所有团队成员使用了！
```

## 错误处理

### 常见错误及处理

1. **配置文件损坏**
   ```
   删除配置文件
   重新进入配置流程
   ```

2. **Skill 路径不存在**
   ```
   提示用户检查路径
   提供路径格式示例
   ```

3. **仓库路径无效**
   ```
   提示用户重新配置
   说明如何找到正确的仓库路径
   ```

4. **Git 操作失败**
   ```
   显示详细错误信息
   提供解决建议
   必要时建议手动操作
   ```

5. **权限问题**
   ```
   提示用户检查：
   - 是否已被添加为协作者
   - Git 配置是否正确
   - 是否有网络连接
   ```

## 配置文件格式

**位置：** `.claude/skill-uploader-config.json`

**格式：**
```json
{
  "repository_path": "F:\\company_GitHub\\company-claude-skills"
}
```

**注意：**
- 使用绝对路径
- Windows 路径使用双反斜杠 `\\`
- 确保路径存在且可访问

## 输出格式规范

### 成功输出

使用清晰的 emoji 和格式化文本：
- ✅ 表示成功
- 📁 表示文件/目录
- 🔗 表示链接
- 使用列表展示步骤

### 错误输出

- ❌ 表示错误
- ⚠️ 表示警告
- 提供清晰的错误原因
- 给出具体的解决建议

## 注意事项

1. **路径处理**
   - 支持 Windows 和 Unix 风格路径
   - 自动处理路径分隔符
   - 验证路径存在性

2. **Git 操作**
   - 始终先 pull 再 push
   - 使用描述性的 commit 消息
   - 捕获并处理 Git 错误

3. **用户体验**
   - 提供清晰的进度反馈
   - 错误信息要具体且有帮助
   - 成功后提供 GitHub 链接

4. **安全性**
   - 不在配置中存储敏感信息
   - 验证所有路径输入
   - 使用用户的 Git 凭证

## 使用工具

执行此 Skill 时需要使用以下工具：

1. **文件操作**
   - `view_file` - 读取配置文件
   - `write_to_file` - 创建配置文件
   - `run_command` - 复制文件（使用系统命令）

2. **Git 操作**
   - `run_command` - 执行 Git 命令
   - 所有 Git 命令都通过 `run_command` 执行

3. **路径处理**
   - 使用 Python 的 `os.path` 或类似功能
   - 验证路径存在性
   - 提取文件夹名称

---

💡 **实现提示**：确保每个步骤都有清晰的反馈，让用户知道当前进度。如果遇到错误，提供具体的解决方案而不是模糊的错误信息。
